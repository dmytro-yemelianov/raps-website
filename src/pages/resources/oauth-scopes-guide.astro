---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout
  title="OAuth Scopes Deep Dive"
  description="Complete guide to APS OAuth scopes with real-world combinations, 2-legged vs 3-legged comparison, and permission matrices"
>
  <section class="py-16 sm:py-24">
    <div class="max-w-4xl mx-auto px-4 sm:px-6">
      <div class="mb-12">
        <h1 class="text-4xl sm:text-5xl font-display font-bold text-white mb-4">
          OAuth Scopes Deep Dive
        </h1>
        <p class="text-xl text-slate-300">
          Master APS OAuth scopes with real-world combinations, security best practices, 
          and comprehensive permission matrices for all APS services.
        </p>
      </div>

      <!-- Quick Reference -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-blue-400 mb-6">Essential Scopes Quick Reference</h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-blue-950/20 border border-blue-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-blue-300 mb-4">2-Legged (App-Only)</h3>
            <div class="space-y-3">
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">bucket:create bucket:read</code>
                <p class="text-sm text-slate-400 mt-1">Create and manage OSS buckets</p>
              </div>
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">data:read data:write data:create</code>
                <p class="text-sm text-slate-400 mt-1">Full file management</p>
              </div>
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">code:all</code>
                <p class="text-sm text-slate-400 mt-1">Model Derivative translations</p>
              </div>
            </div>
          </div>

          <div class="bg-green-950/20 border border-green-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-green-300 mb-4">3-Legged (User Context)</h3>
            <div class="space-y-3">
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">user-profile:read</code>
                <p class="text-sm text-slate-400 mt-1">Access user information</p>
              </div>
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">account:read account:write</code>
                <p class="text-sm text-slate-400 mt-1">Manage ACC/BIM 360 projects</p>
              </div>
              <div class="bg-slate-800 p-3 rounded">
                <code class="text-rapeseed-400">viewables:read</code>
                <p class="text-sm text-slate-400 mt-1">View translated models</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Scope Categories -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-white mb-6">Complete Scope Reference</h2>
        
        <div class="space-y-8">
          <!-- Data Management -->
          <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-rapeseed-400 mb-4">Data Management (OSS)</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-slate-600">
                    <th class="text-left py-2 text-slate-300">Scope</th>
                    <th class="text-left py-2 text-slate-300">Permission</th>
                    <th class="text-left py-2 text-slate-300">Use Case</th>
                    <th class="text-left py-2 text-slate-300">Auth Type</th>
                  </tr>
                </thead>
                <tbody class="text-slate-400">
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-blue-400">bucket:create</td>
                    <td class="py-2">Create new buckets</td>
                    <td class="py-2">Initial app setup</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-blue-400">bucket:read</td>
                    <td class="py-2">List buckets and details</td>
                    <td class="py-2">Browse storage</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-blue-400">bucket:update</td>
                    <td class="py-2">Modify bucket settings</td>
                    <td class="py-2">Change retention policy</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-blue-400">bucket:delete</td>
                    <td class="py-2">Delete buckets</td>
                    <td class="py-2">Cleanup operations</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-green-400">data:read</td>
                    <td class="py-2">Download objects</td>
                    <td class="py-2">File access, backups</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-green-400">data:write</td>
                    <td class="py-2">Upload, modify objects</td>
                    <td class="py-2">File updates</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-green-400">data:create</td>
                    <td class="py-2">Create new objects</td>
                    <td class="py-2">Initial file upload</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Model Derivative -->
          <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-rapeseed-400 mb-4">Model Derivative</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-slate-600">
                    <th class="text-left py-2 text-slate-300">Scope</th>
                    <th class="text-left py-2 text-slate-300">Permission</th>
                    <th class="text-left py-2 text-slate-300">Use Case</th>
                    <th class="text-left py-2 text-slate-300">Auth Type</th>
                  </tr>
                </thead>
                <tbody class="text-slate-400">
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-purple-400">code:all</td>
                    <td class="py-2">Full translation access</td>
                    <td class="py-2">Complete workflows</td>
                    <td class="py-2">2-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-cyan-400">viewables:read</td>
                    <td class="py-2">Access translated models</td>
                    <td class="py-2">Viewer integration</td>
                    <td class="py-2">3-legged</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- User & Account -->
          <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-rapeseed-400 mb-4">User & Account Management</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-slate-600">
                    <th class="text-left py-2 text-slate-300">Scope</th>
                    <th class="text-left py-2 text-slate-300">Permission</th>
                    <th class="text-left py-2 text-slate-300">Use Case</th>
                    <th class="text-left py-2 text-slate-300">Auth Type</th>
                  </tr>
                </thead>
                <tbody class="text-slate-400">
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-yellow-400">user-profile:read</td>
                    <td class="py-2">Read user details</td>
                    <td class="py-2">User identification</td>
                    <td class="py-2">3-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-orange-400">account:read</td>
                    <td class="py-2">Access ACC/BIM 360 projects</td>
                    <td class="py-2">Project browsing</td>
                    <td class="py-2">3-legged</td>
                  </tr>
                  <tr class="border-b border-slate-700">
                    <td class="py-2 font-mono text-orange-400">account:write</td>
                    <td class="py-2">Modify project data</td>
                    <td class="py-2">Project management</td>
                    <td class="py-2">3-legged</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Common Combinations -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-yellow-400 mb-6">Real-World Scope Combinations</h2>
        
        <div class="space-y-6">
          <div class="bg-slate-900/50 border border-yellow-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-yellow-300 mb-3">File Upload & Translation Service</h3>
            <p class="text-slate-300 mb-4">
              For applications that accept user files, translate them, and serve the results.
            </p>
            <div class="bg-slate-800 p-4 rounded-lg mb-4">
              <pre class="text-sm text-slate-300"><code>bucket:create bucket:read data:create data:write data:read code:all</code></pre>
            </div>
            <div class="text-sm text-slate-400">
              <strong>RAPS command:</strong> <code class="text-rapeseed-400">raps auth login --scopes="bucket:create bucket:read data:create data:write data:read code:all"</code>
            </div>
          </div>

          <div class="bg-slate-900/50 border border-green-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-green-300 mb-3">ACC Project Integration</h3>
            <p class="text-slate-300 mb-4">
              For apps that integrate with ACC/BIM 360 projects and need user context.
            </p>
            <div class="bg-slate-800 p-4 rounded-lg mb-4">
              <pre class="text-sm text-slate-300"><code>user-profile:read account:read account:write data:read viewables:read</code></pre>
            </div>
            <div class="text-sm text-slate-400">
              <strong>RAPS command:</strong> <code class="text-rapeseed-400">raps auth login --three-legged --scopes="user-profile:read account:read account:write data:read viewables:read"</code>
            </div>
          </div>

          <div class="bg-slate-900/50 border border-blue-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-blue-300 mb-3">Viewer-Only Application</h3>
            <p class="text-slate-300 mb-4">
              For applications that only need to display translated models.
            </p>
            <div class="bg-slate-800 p-4 rounded-lg mb-4">
              <pre class="text-sm text-slate-300"><code>viewables:read</code></pre>
            </div>
            <div class="text-sm text-slate-400">
              <strong>RAPS command:</strong> <code class="text-rapeseed-400">raps auth login --three-legged --scopes="viewables:read"</code>
            </div>
          </div>

          <div class="bg-slate-900/50 border border-purple-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-purple-300 mb-3">CI/CD Pipeline</h3>
            <p class="text-slate-300 mb-4">
              For automated build systems that process CAD files.
            </p>
            <div class="bg-slate-800 p-4 rounded-lg mb-4">
              <pre class="text-sm text-slate-300"><code>bucket:read data:create data:read code:all</code></pre>
            </div>
            <div class="text-sm text-slate-400">
              <strong>RAPS command:</strong> <code class="text-rapeseed-400">raps auth login --scopes="bucket:read data:create data:read code:all"</code>
            </div>
          </div>
        </div>
      </section>

      <!-- Security Best Practices -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-red-400 mb-6">Security Best Practices</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-red-950/20 border border-red-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-red-300 mb-4">⚠️ Security Don'ts</h3>
            <ul class="text-slate-300 space-y-2">
              <li class="flex items-start gap-2">
                <span class="text-red-400 mt-1">✗</span>
                <span>Don't request more scopes than needed</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-red-400 mt-1">✗</span>
                <span>Don't use 3-legged tokens for server-side operations</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-red-400 mt-1">✗</span>
                <span>Don't store refresh tokens in frontend apps</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-red-400 mt-1">✗</span>
                <span>Don't share tokens between environments</span>
              </li>
            </ul>
          </div>

          <div class="bg-green-950/20 border border-green-500/30 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-green-300 mb-4">✅ Security Best Practices</h3>
            <ul class="text-slate-300 space-y-2">
              <li class="flex items-start gap-2">
                <span class="text-green-400 mt-1">✓</span>
                <span>Use principle of least privilege</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-green-400 mt-1">✓</span>
                <span>Rotate credentials regularly</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-green-400 mt-1">✓</span>
                <span>Use different apps for different environments</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-green-400 mt-1">✓</span>
                <span>Monitor token usage and expiration</span>
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-6 bg-yellow-950/20 border border-yellow-500/30 rounded-lg p-6">
          <h4 class="font-semibold text-yellow-300 mb-2">RAPS Security Features:</h4>
          <ul class="text-slate-300 space-y-1">
            <li>• Automatic token refresh</li>
            <li>• Secure credential storage (OS keyring)</li>
            <li>• Scope validation before requests</li>
            <li>• Token expiration warnings</li>
          </ul>
        </div>
      </section>

      <!-- 2-Legged vs 3-Legged -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-white mb-6">2-Legged vs 3-Legged OAuth</h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-blue-950/20 border border-blue-500/30 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-blue-300 mb-4">2-Legged (App-Only)</h3>
            
            <div class="mb-4">
              <h4 class="font-medium text-white mb-2">When to Use:</h4>
              <ul class="text-slate-300 space-y-1 text-sm">
                <li>• Server-side applications</li>
                <li>• CI/CD pipelines</li>
                <li>• Background processing</li>
                <li>• File storage operations</li>
              </ul>
            </div>

            <div class="mb-4">
              <h4 class="font-medium text-white mb-2">Available Scopes:</h4>
              <ul class="text-slate-400 space-y-1 text-sm">
                <li>• <code>bucket:*</code> - All bucket operations</li>
                <li>• <code>data:*</code> - All file operations</li>
                <li>• <code>code:all</code> - Model translation</li>
              </ul>
            </div>

            <div class="bg-slate-800 p-3 rounded">
              <h4 class="font-medium text-rapeseed-400 mb-2">RAPS Example:</h4>
              <pre class="text-sm text-slate-300"><code>raps auth login
raps upload myfile.dwg
raps translate myfile.dwg</code></pre>
            </div>
          </div>

          <div class="bg-green-950/20 border border-green-500/30 rounded-lg p-6">
            <h3 class="text-xl font-semibold text-green-300 mb-4">3-Legged (User Context)</h3>
            
            <div class="mb-4">
              <h4 class="font-medium text-white mb-2">When to Use:</h4>
              <ul class="text-slate-300 space-y-1 text-sm">
                <li>• Web applications</li>
                <li>• Mobile apps</li>
                <li>• User-specific data access</li>
                <li>• ACC/BIM 360 integration</li>
              </ul>
            </div>

            <div class="mb-4">
              <h4 class="font-medium text-white mb-2">Additional Scopes:</h4>
              <ul class="text-slate-400 space-y-1 text-sm">
                <li>• <code>user-profile:read</code> - User info</li>
                <li>• <code>account:*</code> - ACC projects</li>
                <li>• <code>viewables:read</code> - Viewer access</li>
              </ul>
            </div>

            <div class="bg-slate-800 p-3 rounded">
              <h4 class="font-medium text-rapeseed-400 mb-2">RAPS Example:</h4>
              <pre class="text-sm text-slate-300"><code>raps auth login --three-legged
raps account projects
raps view project-file.rvt</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Troubleshooting -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-red-400 mb-6">Common Scope Issues</h2>
        
        <div class="space-y-4">
          <details class="bg-slate-900/50 border border-slate-700 rounded-lg">
            <summary class="p-4 cursor-pointer font-medium text-white hover:text-rapeseed-400">
              403 Forbidden: Insufficient privileges
            </summary>
            <div class="p-4 pt-0 text-slate-300">
              <p class="mb-2">Your token doesn't have the required scopes.</p>
              <div class="bg-slate-800 p-3 rounded">
                <pre class="text-sm text-slate-300"><code># Check current scopes
raps auth scopes

# Login with additional scopes
raps auth login --scopes="data:read data:write code:all"</code></pre>
              </div>
            </div>
          </details>

          <details class="bg-slate-900/50 border border-slate-700 rounded-lg">
            <summary class="p-4 cursor-pointer font-medium text-white hover:text-rapeseed-400">
              Can't access ACC/BIM 360 projects
            </summary>
            <div class="p-4 pt-0 text-slate-300">
              <p class="mb-2">You need 3-legged authentication with account scopes.</p>
              <div class="bg-slate-800 p-3 rounded">
                <pre class="text-sm text-slate-300"><code># Use 3-legged auth for user context
raps auth login --three-legged --scopes="account:read user-profile:read"</code></pre>
              </div>
            </div>
          </details>

          <details class="bg-slate-900/50 border border-slate-700 rounded-lg">
            <summary class="p-4 cursor-pointer font-medium text-white hover:text-rapeseed-400">
              Translation jobs fail with permissions error
            </summary>
            <div class="p-4 pt-0 text-slate-300">
              <p class="mb-2">Model Derivative requires both data access and code:all scope.</p>
              <div class="bg-slate-800 p-3 rounded">
                <pre class="text-sm text-slate-300"><code># Ensure you have both data and translation scopes
raps auth login --scopes="data:read code:all"</code></pre>
              </div>
            </div>
          </details>
        </div>
      </section>

      <!-- Related Resources -->
      <div class="bg-gradient-to-r from-slate-800 to-slate-700 rounded-xl p-6">
        <h3 class="text-xl font-bold text-white mb-4">Related Resources</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <a href="/tools/scope-builder" class="text-rapeseed-400 hover:text-rapeseed-300 transition-colors">
            → OAuth Scope Builder Tool
          </a>
          <a href="/resources/error-codes" class="text-rapeseed-400 hover:text-rapeseed-300 transition-colors">
            → Error Codes Reference
          </a>
          <a href="/docs/authentication" class="text-rapeseed-400 hover:text-rapeseed-300 transition-colors">
            → Authentication Documentation
          </a>
          <a href="/tools/token-decoder" class="text-rapeseed-400 hover:text-rapeseed-300 transition-colors">
            → Token Decoder Tool
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>