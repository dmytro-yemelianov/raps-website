---
import BaseLayout from '../layouts/BaseLayout.astro';

// API Coverage data
const services = [
  {
    name: 'Authentication',
    icon: 'üîê',
    features: [
      { name: '2-legged OAuth (Client Credentials)', command: 'auth test', status: 'full' },
      { name: '3-legged OAuth (Authorization Code)', command: 'auth login', status: 'full' },
      { name: 'Device Code Flow', command: 'auth login --device', status: 'full' },
      { name: 'Headless Auto-Detection', command: 'auth login (auto)', status: 'full' },
      { name: 'Token Inspection', command: 'auth inspect', status: 'full' },
      { name: 'User Profile', command: 'auth whoami', status: 'full' },
    ]
  },
  {
    name: 'Object Storage (OSS)',
    icon: 'üì¶',
    features: [
      { name: 'Bucket CRUD', command: 'bucket create/list/info/delete', status: 'full' },
      { name: 'Streaming Bucket List', command: 'bucket list (per-region)', status: 'full' },
      { name: 'Object Upload', command: 'object upload', status: 'full' },
      { name: 'Resumable Uploads', command: 'object upload (auto)', status: 'full' },
      { name: 'Batch Upload', command: 'object upload-batch', status: 'full' },
      { name: 'Object Download', command: 'object download', status: 'full' },
      { name: 'Signed URLs', command: 'object signed-url', status: 'full' },
      { name: 'Object URN', command: 'object urn', status: 'full' },
      { name: 'Copy & Rename', command: 'object copy/rename', status: 'full' },
    ]
  },
  {
    name: 'Model Derivative',
    icon: 'üîÑ',
    features: [
      { name: 'Translation Jobs', command: 'translate start', status: 'full' },
      { name: 'Translation Presets', command: 'translate preset list/show/create/use', status: 'full' },
      { name: 'Status Polling', command: 'translate status', status: 'full' },
      { name: 'Manifest/Metadata', command: 'translate manifest/metadata', status: 'full' },
      { name: 'Derivative Download', command: 'translate download', status: 'full' },
      { name: 'Object Tree', command: 'translate tree', status: 'full' },
      { name: 'Properties Query', command: 'translate properties/query-properties', status: 'full' },
      { name: 'SVF/SVF2 Output', command: '--format svf/svf2', status: 'full' },
      { name: 'OBJ/STL/STEP Export', command: '--format obj/stl/step', status: 'full' },
      { name: 'Thumbnail Generation', command: '--format thumbnail', status: 'full' },
    ]
  },
  {
    name: 'Data Management',
    icon: 'üèóÔ∏è',
    features: [
      { name: 'Hub Listing', command: 'hub list/info', status: 'full' },
      { name: 'Project Listing', command: 'project list/info', status: 'full' },
      { name: 'Folder Operations', command: 'folder list/create/rename/delete/rights', status: 'full' },
      { name: 'Item Operations', command: 'item info/versions/create-from-oss/rename/delete', status: 'full' },
      { name: 'BIM 360 Support', command: '(integrated)', status: 'full' },
      { name: 'ACC Support', command: '(integrated)', status: 'full' },
    ]
  },
  {
    name: 'ACC Issues',
    icon: 'üîß',
    features: [
      { name: 'Issue CRUD', command: 'issue list/create/update/delete', status: 'full' },
      { name: 'Bulk CSV Import', command: 'issue create --from-csv', status: 'full' },
      { name: 'Issue Types', command: 'issue types', status: 'full' },
      { name: 'Comments', command: 'issue comment list/add/delete', status: 'full' },
      { name: 'Attachments', command: 'issue attachments', status: 'full' },
      { name: 'State Transitions', command: 'issue transition', status: 'full' },
    ]
  },
  {
    name: 'ACC RFIs',
    icon: '‚ùì',
    features: [
      { name: 'RFI CRUD', command: 'rfi list/get/create/update/delete', status: 'full' },
      { name: 'Bulk CSV Import', command: 'rfi create --from-csv', status: 'full' },
    ]
  },
  {
    name: 'ACC Extended',
    icon: 'üìã',
    features: [
      { name: 'Assets', command: 'acc asset list/get/create/update/delete', status: 'full' },
      { name: 'Submittals', command: 'acc submittal list/get/create/update/delete', status: 'full' },
      { name: 'Checklists', command: 'acc checklist list/get/create/update', status: 'full' },
      { name: 'Checklist Templates', command: 'acc checklist templates', status: 'full' },
    ]
  },
  {
    name: 'Account Admin',
    icon: 'üë•',
    features: [
      { name: 'User Management', command: 'admin user list/add/remove/update', status: 'full' },
      { name: 'Project Users', command: 'admin user add-to-project/remove-from-project', status: 'full' },
      { name: 'Bulk CSV Import', command: 'admin user import', status: 'full' },
      { name: 'Project Management', command: 'admin project list/create/update/archive', status: 'full' },
      { name: 'Folder Permissions', command: 'admin folder rights', status: 'full' },
      { name: 'Company List', command: 'admin company-list', status: 'full' },
      { name: 'Resumable Operations', command: 'admin operation status/resume/cancel', status: 'full' },
    ]
  },
  {
    name: 'Design Automation',
    icon: '‚öôÔ∏è',
    features: [
      { name: 'Engine Discovery', command: 'da engines', status: 'full' },
      { name: 'Activity Management', command: 'da activities/activity-create/activity-delete', status: 'full' },
      { name: 'App Bundles', command: 'da appbundles/appbundle-create/appbundle-delete', status: 'full' },
      { name: 'Work Items', command: 'da run/workitems/status', status: 'full' },
    ]
  },
  {
    name: 'Reality Capture',
    icon: 'üì∏',
    features: [
      { name: 'Photoscene CRUD', command: 'reality list/create/delete', status: 'full' },
      { name: 'Photo Upload', command: 'reality upload', status: 'full' },
      { name: 'Processing', command: 'reality process', status: 'full' },
      { name: 'Status & Results', command: 'reality status/result', status: 'full' },
      { name: 'Output Formats', command: 'reality formats', status: 'full' },
    ]
  },
  {
    name: 'Webhooks',
    icon: 'üîî',
    features: [
      { name: 'Subscription CRUD', command: 'webhook create/list/get/update/delete', status: 'full' },
      { name: 'Event Discovery', command: 'webhook events', status: 'full' },
      { name: 'Endpoint Testing', command: 'webhook test', status: 'full' },
      { name: 'Signature Verification', command: 'webhook verify-signature', status: 'full' },
    ]
  },
  {
    name: 'Custom API',
    icon: 'üîó',
    features: [
      { name: 'GET Requests', command: 'api get', status: 'full' },
      { name: 'POST Requests', command: 'api post', status: 'full' },
      { name: 'PUT/PATCH/DELETE', command: 'api put/patch/delete', status: 'full' },
    ]
  },
  {
    name: 'Reporting',
    icon: 'üìä',
    features: [
      { name: 'RFI Summary', command: 'report rfi-summary', status: 'full' },
      { name: 'Issues Summary', command: 'report issues-summary', status: 'full' },
      { name: 'Submittals Summary', command: 'report submittals-summary', status: 'full' },
      { name: 'Checklists Summary', command: 'report checklists-summary', status: 'full' },
      { name: 'Assets Summary', command: 'report assets-summary', status: 'full' },
    ]
  },
  {
    name: 'Templates',
    icon: 'üìù',
    features: [
      { name: 'Template CRUD', command: 'template list/info/create/update/archive', status: 'full' },
    ]
  },
  {
    name: 'Pipelines',
    icon: 'üìã',
    features: [
      { name: 'Run Pipelines', command: 'pipeline run', status: 'full' },
      { name: 'Validate', command: 'pipeline validate', status: 'full' },
      { name: 'Generate Sample', command: 'pipeline sample', status: 'full' },
    ]
  },
  {
    name: 'MCP Server',
    icon: 'ü§ñ',
    features: [
      { name: 'AI Tool Integration', command: 'serve', status: 'full' },
      { name: 'Authentication Tools', command: 'auth_test, auth_status, auth_login', status: 'full' },
      { name: 'OSS Tools', command: 'bucket_*, object_*', status: 'full' },
      { name: 'Translation Tools', command: 'translate_*', status: 'full' },
      { name: 'Data Management Tools', command: 'hub_*, project_*, folder_*, item_*', status: 'full' },
      { name: 'ACC Tools', command: 'issue_*, rfi_*, asset_*, submittal_*, checklist_*', status: 'full' },
      { name: 'Admin Tools', command: 'admin_*', status: 'full' },
    ]
  },
];

const statusLabels = {
  full: { label: '‚úì', class: 'bg-emerald-500/10 text-emerald-400' },
  partial: { label: '‚óê', class: 'bg-amber-500/10 text-amber-400' },
  new: { label: '‚òÖ', class: 'bg-purple-500/10 text-purple-400' },
  planned: { label: '‚óã', class: 'bg-slate-500/10 text-slate-400' },
};

// Calculate stats
const totalFeatures = services.reduce((acc, s) => acc + s.features.length, 0);
const fullFeatures = services.reduce((acc, s) => acc + s.features.filter(f => f.status === 'full').length, 0);
const newFeatures = services.reduce((acc, s) => acc + s.features.filter(f => f.status === 'new').length, 0);
---

<BaseLayout title="API Coverage" description="Comprehensive overview of APS API coverage in RAPS CLI">
  <section class="py-16 sm:py-24">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">

      <!-- Header -->
      <div class="mb-12 sm:mb-16">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-3">
          API Coverage
        </h1>
        <p class="text-base sm:text-lg text-slate-400 max-w-2xl">
          {services.length} APS services ‚Ä¢ {totalFeatures} features implemented
        </p>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-8 sm:mb-12">
        <div class="p-4 sm:p-5 bg-slate-900/30 border border-slate-800 rounded-lg">
          <div class="text-2xl sm:text-3xl font-bold text-white mb-1">{services.length}</div>
          <div class="text-xs sm:text-sm text-slate-400">Services</div>
        </div>
        <div class="p-4 sm:p-5 bg-slate-900/30 border border-slate-800 rounded-lg">
          <div class="text-2xl sm:text-3xl font-bold text-emerald-400 mb-1">{totalFeatures}</div>
          <div class="text-xs sm:text-sm text-slate-400">Features</div>
        </div>
        <div class="p-4 sm:p-5 bg-slate-900/30 border border-slate-800 rounded-lg">
          <div class="text-2xl sm:text-3xl font-bold text-emerald-400 mb-1">{fullFeatures}</div>
          <div class="text-xs sm:text-sm text-slate-400">Full Coverage</div>
        </div>
        <div class="p-4 sm:p-5 bg-slate-900/30 border border-slate-800 rounded-lg">
          <div class="text-2xl sm:text-3xl font-bold text-purple-400 mb-1">{services.length}</div>
          <div class="text-xs sm:text-sm text-slate-400">Service Categories</div>
        </div>
      </div>

      <!-- Legend -->
      <div class="flex flex-wrap gap-3 sm:gap-4 mb-8 text-xs sm:text-sm text-slate-400">
        <span class="flex items-center gap-1.5">
          <span class="text-emerald-400 text-base">‚úì</span> Full
        </span>
        <span class="flex items-center gap-1.5">
          <span class="text-amber-400 text-base">‚óê</span> Partial
        </span>
        <span class="flex items-center gap-1.5">
          <span class="text-purple-400 text-base">‚òÖ</span> New
        </span>
      </div>

      <!-- Services List -->
      <div class="space-y-6 sm:space-y-8">
        {services.map((service) => (
          <div class="border border-slate-800 rounded-lg overflow-hidden">
            <!-- Service Header -->
            <div class="px-4 sm:px-6 py-3 sm:py-4 bg-slate-900/50 border-b border-slate-800">
              <h2 class="text-lg sm:text-xl font-semibold text-white flex items-center gap-2 sm:gap-3">
                <span class="text-xl sm:text-2xl emoji">{service.icon}</span>
                <span>{service.name}</span>
              </h2>
            </div>

            <!-- Features Table -->
            <div class="divide-y divide-slate-800/50">
              {service.features.map((feature) => (
                <div class="px-4 sm:px-6 py-2.5 sm:py-3 hover:bg-slate-900/30 transition-colors">
                  <div class="flex items-start sm:items-center justify-between gap-3 sm:gap-4">
                    <div class="flex-1 min-w-0">
                      <div class="text-sm sm:text-base text-white mb-0.5 sm:mb-1">{feature.name}</div>
                      <code class="text-xs sm:text-sm text-slate-500 font-mono break-all">{feature.command}</code>
                    </div>
                    <div class:list={[
                      "flex items-center justify-center w-6 h-6 sm:w-7 sm:h-7 rounded text-base sm:text-lg shrink-0",
                      statusLabels[feature.status].class
                    ]}>
                      {statusLabels[feature.status].label}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>

      <!-- Footer Info -->
      <div class="mt-12 sm:mt-16 p-4 sm:p-6 bg-slate-900/30 border border-slate-800 rounded-lg">
        <p class="text-sm sm:text-base text-slate-400 mb-3 sm:mb-4">
          Built on official <a
            href="https://github.com/autodesk-platform-services/aps-sdk-openapi"
            target="_blank"
            rel="noopener noreferrer"
            class="text-emerald-400 hover:text-emerald-300 underline underline-offset-2"
          >APS OpenAPI Specs</a>
        </p>
        <div class="flex flex-wrap gap-2 sm:gap-3">
          <a
            href="https://github.com/dmytro-yemelianov/raps"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-slate-800 hover:bg-slate-700 text-white text-xs sm:text-sm font-medium rounded transition-colors"
          >
            <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z" />
            </svg>
            GitHub
          </a>
          <a
            href="https://github.com/dmytro-yemelianov/raps/issues/new"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 bg-slate-800 hover:bg-slate-700 text-white text-xs sm:text-sm font-medium rounded transition-colors"
          >
            Request Feature
          </a>
        </div>
      </div>

    </div>
  </section>
</BaseLayout>
