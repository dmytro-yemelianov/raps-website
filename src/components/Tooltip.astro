---
interface Props {
  term: string;
  definition: string;
  href?: string;
}

const { term, definition, href } = Astro.props;
const glossaryLink = href || `/glossary#${term.toLowerCase().replace(/\s+/g, '-')}`;
---

<span class="tooltip-wrapper group relative inline">
  <span
    class="tooltip-trigger cursor-help border-b border-dotted border-slate-500 hover:border-rapeseed-400 transition-colors"
    tabindex="0"
    role="button"
    aria-describedby={`tooltip-${term.replace(/\s+/g, '-')}`}
  >
    <slot>{term}</slot>
  </span>
  <span
    id={`tooltip-${term.replace(/\s+/g, '-')}`}
    role="tooltip"
    class="tooltip-content pointer-events-none absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 sm:w-80 px-3 py-2 text-sm text-slate-200 bg-slate-800 border border-slate-700 rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 z-50"
  >
    <span class="block font-semibold text-rapeseed-400 mb-1">{term}</span>
    <span class="block text-slate-300 leading-relaxed">{definition}</span>
    <a
      href={glossaryLink}
      class="pointer-events-auto inline-flex items-center gap-1 mt-2 text-xs text-slate-400 hover:text-rapeseed-400 transition-colors"
    >
      View in glossary
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
    <!-- Arrow -->
    <span class="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-800"></span>
  </span>
</span>

<style>
  /* Ensure tooltip stays visible when hovering over it */
  .tooltip-wrapper:hover .tooltip-content,
  .tooltip-wrapper:focus-within .tooltip-content {
    pointer-events: auto;
  }

  /* Adjust tooltip position for edge cases */
  @media (max-width: 640px) {
    .tooltip-content {
      left: 0;
      transform: translateX(0);
    }
    .tooltip-content > span:last-of-type {
      left: 1rem;
      transform: translateX(0);
    }
  }
</style>
