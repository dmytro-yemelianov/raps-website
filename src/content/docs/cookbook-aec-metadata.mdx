---
title: "Metadata Extraction"
description: "Extract BIM metadata for analysis and reporting"
section: "cookbook"
order: 12
icon: "ðŸ“Š"
---

# Metadata Extraction

Pull metadata from translated Revit models for analysis or reporting.

## Workflow Overview

<div class="not-prose my-8">
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="rounded-lg border-2 border-blue-500/50 bg-blue-950/30 p-4">
      <div class="text-xs font-semibold text-blue-400 uppercase tracking-wide mb-3">Input</div>
      <div class="bg-blue-900/30 rounded px-3 py-2 text-sm text-slate-300 text-center">
        Translated Model<br/><span class="text-blue-400 font-mono text-xs">SVF2 URN</span>
      </div>
    </div>
    <div class="rounded-lg border-2 border-purple-500/50 bg-purple-950/30 p-4">
      <div class="text-xs font-semibold text-purple-400 uppercase tracking-wide mb-3">Model Derivative API</div>
      <div class="space-y-2">
        <div class="bg-purple-900/30 rounded px-3 py-2 text-sm text-slate-300">Get Metadata</div>
        <div class="bg-purple-900/30 rounded px-3 py-2 text-sm text-slate-300">Get Tree</div>
        <div class="bg-purple-900/30 rounded px-3 py-2 text-sm text-slate-300">Get Properties</div>
        <div class="bg-purple-900/30 rounded px-3 py-2 text-sm text-slate-300">Get Views</div>
      </div>
    </div>
    <div class="rounded-lg border-2 border-amber-500/50 bg-amber-950/30 p-4">
      <div class="text-xs font-semibold text-amber-400 uppercase tracking-wide mb-3">Outputs</div>
      <div class="space-y-2">
        <div class="bg-amber-900/30 rounded px-3 py-2 text-sm">
          <span class="font-mono text-amber-300">metadata.json</span>
          <span class="text-slate-400 text-xs block">GUIDs, Info</span>
        </div>
        <div class="bg-amber-900/30 rounded px-3 py-2 text-sm">
          <span class="font-mono text-amber-300">tree.json</span>
          <span class="text-slate-400 text-xs block">Hierarchy</span>
        </div>
        <div class="bg-amber-900/30 rounded px-3 py-2 text-sm">
          <span class="font-mono text-amber-300">properties.json</span>
          <span class="text-slate-400 text-xs block">BIM Data</span>
        </div>
        <div class="bg-amber-900/30 rounded px-3 py-2 text-sm">
          <span class="font-mono text-amber-300">views.json</span>
          <span class="text-slate-400 text-xs block">View List</span>
        </div>
      </div>
    </div>
    <div class="rounded-lg border-2 border-emerald-500/50 bg-emerald-950/30 p-4">
      <div class="text-xs font-semibold text-emerald-400 uppercase tracking-wide mb-3">Export</div>
      <div class="space-y-2">
        <div class="bg-emerald-900/30 rounded px-3 py-2 text-sm text-slate-300">Reports</div>
        <div class="bg-emerald-900/30 rounded px-3 py-2 text-sm text-slate-300">CSV</div>
        <div class="bg-emerald-900/30 rounded px-3 py-2 text-sm text-slate-300">Database</div>
      </div>
    </div>
  </div>
  <div class="flex justify-center mt-4">
    <div class="flex items-center gap-2 text-slate-500 text-sm">
      <span>Input</span>
      <span>&#8594;</span>
      <span>API</span>
      <span>&#8594;</span>
      <span>Outputs</span>
      <span>&#8594;</span>
      <span>Export</span>
    </div>
  </div>
</div>

---

## CLI Approach

### Step 1: Get Model URN

```bash
URN=$(raps object urn my-bucket building.rvt --output plain)
```

### Step 2: Check Translation Status

```bash
raps translate manifest "$URN"
```

### Step 3: Extract All Metadata

```bash
# Model metadata (GUID, views, etc.)
raps derivative metadata "$URN" --output json > metadata.json

# Model hierarchy
raps derivative tree "$URN" --output json > model-tree.json

# All properties (BIM data)
raps derivative properties "$URN" --output json > properties.json

# Available views
raps derivative views "$URN" --output json > views.json
```

### Step 4: Analyze Data

```bash
# Count elements by category
cat properties.json | jq 'group_by(.category) | .[] | {category: .[0].category, count: length}'

# Export specific properties to CSV
cat properties.json | jq -r '
  ["ObjectId", "Name", "Category"],
  (.[] | [.objectid, .name, .category])
  | @csv' > elements.csv
```

---

## CI/CD Pipeline

```yaml
# .github/workflows/metadata-extraction.yml
name: BIM Metadata Extraction

on:
  workflow_dispatch:
    inputs:
      bucket:
        description: 'Bucket name'
        required: true
      model:
        description: 'Model filename'
        required: true

jobs:
  extract-metadata:
    runs-on: ubuntu-latest
    steps:
      - name: Install RAPS
        run: cargo install raps

      - name: Extract all metadata
        env:
          APS_CLIENT_ID: ${{ secrets.APS_CLIENT_ID }}
          APS_CLIENT_SECRET: ${{ secrets.APS_CLIENT_SECRET }}
        run: |
          URN=$(raps object urn "${{ inputs.bucket }}" "${{ inputs.model }}" --output plain)

          mkdir -p ./metadata-export

          raps derivative metadata "$URN" --output json > ./metadata-export/metadata.json
          raps derivative tree "$URN" --output json > ./metadata-export/tree.json
          raps derivative properties "$URN" --output json > ./metadata-export/properties.json
          raps derivative views "$URN" --output json > ./metadata-export/views.json

      - name: Generate summary
        run: |
          echo "# Metadata Summary" > ./metadata-export/summary.md
          echo "Model: ${{ inputs.model }}" >> ./metadata-export/summary.md
          echo "Elements: $(jq 'length' ./metadata-export/properties.json)" >> ./metadata-export/summary.md
          echo "Views: $(jq 'length' ./metadata-export/views.json)" >> ./metadata-export/summary.md

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: bim-metadata-${{ github.run_id }}
          path: ./metadata-export/
```

### Pipeline Flow

<div class="not-prose my-6">
  <div class="flex flex-col sm:flex-row items-stretch gap-3">
    <div class="flex-1 rounded-lg border border-blue-500/50 bg-blue-950/30 p-3">
      <div class="text-xs font-semibold text-blue-400 uppercase tracking-wide mb-2">Manual Trigger</div>
      <div class="bg-blue-900/30 rounded px-3 py-2 text-sm text-slate-300">
        workflow_dispatch<br/><span class="text-blue-400 text-xs">bucket + model</span>
      </div>
    </div>
    <div class="hidden sm:flex items-center text-slate-500">&#8594;</div>
    <div class="flex-1 rounded-lg border border-purple-500/50 bg-purple-950/30 p-3">
      <div class="text-xs font-semibold text-purple-400 uppercase tracking-wide mb-2">Extraction</div>
      <div class="space-y-1">
        <div class="bg-purple-900/30 rounded px-3 py-1.5 text-sm text-slate-300">Get URN</div>
        <div class="bg-purple-900/30 rounded px-3 py-1.5 text-sm font-mono text-purple-300">metadata.json</div>
        <div class="bg-purple-900/30 rounded px-3 py-1.5 text-sm font-mono text-purple-300">tree.json</div>
        <div class="bg-purple-900/30 rounded px-3 py-1.5 text-sm font-mono text-purple-300">properties.json</div>
        <div class="bg-purple-900/30 rounded px-3 py-1.5 text-sm font-mono text-purple-300">views.json</div>
      </div>
    </div>
    <div class="hidden sm:flex items-center text-slate-500">&#8594;</div>
    <div class="flex-1 rounded-lg border border-purple-500/50 bg-purple-950/30 p-3">
      <div class="text-xs font-semibold text-purple-400 uppercase tracking-wide mb-2">Analysis</div>
      <div class="bg-purple-900/30 rounded px-3 py-2 text-sm text-slate-300">Generate Summary</div>
    </div>
    <div class="hidden sm:flex items-center text-slate-500">&#8594;</div>
    <div class="flex-1 rounded-lg border border-emerald-500/50 bg-emerald-950/30 p-3">
      <div class="text-xs font-semibold text-emerald-400 uppercase tracking-wide mb-2">Artifacts</div>
      <div class="bg-emerald-900/30 rounded px-3 py-2 text-sm font-mono text-emerald-300">bim-metadata.zip</div>
    </div>
  </div>
</div>

---

## MCP Integration

### Extract and Summarize

```
User: "Extract all metadata from building.rvt and summarize the room count"
```

<div class="not-prose my-6">
  <div class="bg-slate-900/50 rounded-lg border border-slate-700 p-4">
    <div class="flex gap-4 mb-4 text-xs font-semibold">
      <div class="flex-1 text-center py-2 rounded bg-blue-900/30 text-blue-400">User</div>
      <div class="flex-1 text-center py-2 rounded bg-purple-900/30 text-purple-400">AI Assistant</div>
      <div class="flex-1 text-center py-2 rounded bg-amber-900/30 text-amber-400">RAPS MCP</div>
      <div class="flex-1 text-center py-2 rounded bg-emerald-900/30 text-emerald-400">APS Cloud</div>
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex items-center gap-2">
        <div class="flex-1 text-right text-blue-400">Extract metadata, summarize rooms</div>
        <div class="text-slate-500">&#8594;</div>
        <div class="flex-1 text-purple-400"></div>
        <div class="flex-1"></div>
        <div class="flex-1"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1 text-right text-purple-400">aps_object_urn()</div>
        <div class="text-slate-500">&#8594;</div>
        <div class="flex-1 text-amber-400"></div>
        <div class="flex-1"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1"></div>
        <div class="flex-1 text-right text-amber-400">Get URN</div>
        <div class="text-slate-500">&#8594;</div>
        <div class="flex-1 text-emerald-400"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1 text-purple-400"></div>
        <div class="text-slate-500">&#8592;</div>
        <div class="flex-1 text-left text-amber-400">URN</div>
        <div class="flex-1"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1 text-right text-purple-400">aps_derivative_properties()</div>
        <div class="text-slate-500">&#8594;</div>
        <div class="flex-1 text-amber-400"></div>
        <div class="flex-1"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1"></div>
        <div class="flex-1 text-right text-amber-400">Get properties</div>
        <div class="text-slate-500">&#8594;</div>
        <div class="flex-1 text-emerald-400"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1"></div>
        <div class="flex-1 text-amber-400"></div>
        <div class="text-slate-500">&#8592;</div>
        <div class="flex-1 text-left text-emerald-400">Properties JSON</div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1"></div>
        <div class="flex-1 text-center text-purple-400 italic">Filter rooms, calculate areas</div>
        <div class="flex-1"></div>
        <div class="flex-1"></div>
      </div>
      <div class="flex items-center gap-2">
        <div class="flex-1 text-blue-400"></div>
        <div class="text-slate-500">&#8592;</div>
        <div class="flex-1 text-left text-purple-400">Room summary by level</div>
        <div class="flex-1"></div>
        <div class="flex-1"></div>
      </div>
    </div>
  </div>
</div>

**AI Response:**
> I found 47 rooms in the model:
> - Level 1: 15 rooms (3,450 sq ft total)
> - Level 2: 18 rooms (4,200 sq ft total)
> - Level 3: 14 rooms (3,100 sq ft total)

### Compare Models

```
User: "Compare the element counts between v1 and v2 of the building model"
```

**AI Response:**
> Model Comparison:
> | Category | v1 | v2 | Change |
> |----------|-----|-----|--------|
> | Walls | 245 | 258 | +13 |
> | Doors | 89 | 92 | +3 |
> | Windows | 156 | 156 | 0 |
> | Rooms | 47 | 52 | +5 |

---

## Common Queries

### Count by Category

```bash
cat properties.json | jq '
  group_by(.category) |
  map({category: .[0].category, count: length}) |
  sort_by(-.count)'
```

### Find Specific Elements

```bash
# Find all doors
cat properties.json | jq '[.[] | select(.category == "Doors")]'

# Find elements by name pattern
cat properties.json | jq '[.[] | select(.name | test("Wall.*Exterior"))]'
```

### Export to Database Format

```bash
# Generate SQL inserts
cat properties.json | jq -r '.[] |
  "INSERT INTO elements (id, name, category) VALUES (\(.objectid), '\''\(.name)'\'', '\''\(.category)'\'');"'
```

---

## Related

- [Room & Space Export](/docs/cookbook-aec-rooms)
- [Model Coordination Pipeline](/docs/cookbook-aec-coordination)
- [Cookbook: AEC & BIM](/docs/cookbook-aec)
