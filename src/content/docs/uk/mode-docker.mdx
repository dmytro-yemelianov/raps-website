---
title: "Docker"
description: "–ó–∞–ø—É—Å–∫ RAPS —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ"
section: "modes"
order: 5
icon: "üê≥"
---

# –†–µ–∂–∏–º Docker

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ RAPS —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –±–µ–∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Rust –∞–±–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏. –Ü–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è CI/CD –∫–æ–Ω–≤–µ—î—Ä—ñ–≤, —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —É Kubernetes.

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –æ–±—Ä–∞–∑
docker pull ghcr.io/dmytro-yemelianov/raps:latest

# –í–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É
docker run --rm \
  -e APS_CLIENT_ID="your_client_id" \
  -e APS_CLIENT_SECRET="your_client_secret" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  auth test
```

## –î–æ—Å—Ç—É–ø–Ω—ñ –æ–±—Ä–∞–∑–∏

| –¢–µ–≥ | –û–ø–∏—Å |
|-----|------|
| `latest` | –û—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π —Ä–µ–ª—ñ–∑ |
| `3.8.0` | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –≤–µ—Ä—Å—ñ—è |
| `3.8` | –û—Å—Ç–∞–Ω–Ω—ñ–π –ø–∞—Ç—á —Å–µ—Ä—ñ—ó 3.8.x |
| `3` | –û—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ–Ω–æ—Ä–Ω–∏–π —Ä–µ–ª—ñ–∑ —Å–µ—Ä—ñ—ó 3.x |

### –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫—ñ–ª—å–∫–æ—Ö –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä

–û–±—Ä–∞–∑–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è:
- `linux/amd64` (x86_64)
- `linux/arm64` (Apple Silicon, ARM-—Å–µ—Ä–≤–µ—Ä–∏)

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
docker pull --platform linux/arm64 ghcr.io/dmytro-yemelianov/raps:latest
```

## –ë–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –û–∫—Ä–µ–º—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é
docker run --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  auth test

# –°–ø–∏—Å–æ–∫ –±–∞–∫–µ—Ç—ñ–≤
docker run --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  bucket list --output json
```

### –ó –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è–º —Ç–æ–º—ñ–≤

–ú–æ–Ω—Ç—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è/–≤–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤:

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
docker run --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  -v $(pwd)/models:/data \
  ghcr.io/dmytro-yemelianov/raps:latest \
  object upload my-bucket /data/model.rvt

# –°–∫–∞—á–∞—Ç–∏ —Ñ–∞–π–ª–∏
docker run --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  -v $(pwd)/downloads:/output \
  ghcr.io/dmytro-yemelianov/raps:latest \
  object download my-bucket model.rvt --output /output/
```

### –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º

–ó–∞–ø—É—Å–∫ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—ó –æ–±–æ–ª–æ–Ω–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Docker:

```bash
docker run -it --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  shell
```

## Docker Compose

### –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```yaml
# docker-compose.yml
version: '3.8'

services:
  raps:
    image: ghcr.io/dmytro-yemelianov/raps:latest
    environment:
      - APS_CLIENT_ID=${APS_CLIENT_ID}
      - APS_CLIENT_SECRET=${APS_CLIENT_SECRET}
    volumes:
      - ./models:/data
    command: ["bucket", "list"]
```

–ó–∞–ø—É—Å–∫:

```bash
docker-compose run --rm raps bucket list
docker-compose run --rm raps object upload my-bucket /data/model.rvt
```

### –ë–∞–≥–∞—Ç–æ—Å–µ—Ä–≤—ñ—Å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```yaml
# docker-compose.yml
version: '3.8'

services:
  # –°–µ—Ä–≤—ñ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  uploader:
    image: ghcr.io/dmytro-yemelianov/raps:latest
    environment:
      - APS_CLIENT_ID=${APS_CLIENT_ID}
      - APS_CLIENT_SECRET=${APS_CLIENT_SECRET}
    volumes:
      - ./models:/data:ro
    profiles: ["upload"]
    command: ["object", "upload", "my-bucket", "/data/"]

  # –ú–æ–Ω—ñ—Ç–æ—Ä —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ–π
  translator:
    image: ghcr.io/dmytro-yemelianov/raps:latest
    environment:
      - APS_CLIENT_ID=${APS_CLIENT_ID}
      - APS_CLIENT_SECRET=${APS_CLIENT_SECRET}
    profiles: ["translate"]

  # –ó–∞–¥–∞—á—ñ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
  cleanup:
    image: ghcr.io/dmytro-yemelianov/raps:latest
    environment:
      - APS_CLIENT_ID=${APS_CLIENT_ID}
      - APS_CLIENT_SECRET=${APS_CLIENT_SECRET}
    profiles: ["cleanup"]
    command: ["bucket", "list", "--output", "json"]
```

## –§–∞–π–ª —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ–∞–π–ª `.env` –¥–ª—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö:

```ini
# .env
APS_CLIENT_ID=your_client_id
APS_CLIENT_SECRET=your_client_secret
APS_REGION=US
```

```bash
# Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å .env
docker-compose run --rm raps auth test
```

## –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ CI/CD

### GitLab CI

```yaml
# .gitlab-ci.yml
variables:
  RAPS_IMAGE: ghcr.io/dmytro-yemelianov/raps:3.8.0

translate:
  image: $RAPS_IMAGE
  variables:
    APS_CLIENT_ID: $APS_CLIENT_ID
    APS_CLIENT_SECRET: $APS_CLIENT_SECRET
  script:
    - raps auth test
    - raps bucket create ci-$CI_PIPELINE_ID --retention transient
    - raps object upload ci-$CI_PIPELINE_ID models/*.rvt --batch
  after_script:
    - raps bucket delete ci-$CI_PIPELINE_ID --yes || true
```

### Jenkins Pipeline

```groovy
// Jenkinsfile
pipeline {
    agent {
        docker {
            image 'ghcr.io/dmytro-yemelianov/raps:3.8.0'
        }
    }
    environment {
        APS_CLIENT_ID = credentials('aps-client-id')
        APS_CLIENT_SECRET = credentials('aps-client-secret')
    }
    stages {
        stage('Test Auth') {
            steps {
                sh 'raps auth test'
            }
        }
        stage('Upload') {
            steps {
                sh 'raps object upload my-bucket models/*.rvt --batch'
            }
        }
    }
}
```

### Azure DevOps

```yaml
# azure-pipelines.yml
pool:
  vmImage: 'ubuntu-latest'

container:
  image: ghcr.io/dmytro-yemelianov/raps:3.8.0

variables:
  - group: aps-credentials

steps:
  - script: raps auth test
    env:
      APS_CLIENT_ID: $(APS_CLIENT_ID)
      APS_CLIENT_SECRET: $(APS_CLIENT_SECRET)

  - script: raps bucket list --output json
    env:
      APS_CLIENT_ID: $(APS_CLIENT_ID)
      APS_CLIENT_SECRET: $(APS_CLIENT_SECRET)
```

### CircleCI

```yaml
# .circleci/config.yml
version: 2.1

jobs:
  translate:
    docker:
      - image: ghcr.io/dmytro-yemelianov/raps:3.8.0
    environment:
      APS_CLIENT_ID: $APS_CLIENT_ID
      APS_CLIENT_SECRET: $APS_CLIENT_SECRET
    steps:
      - checkout
      - run: raps auth test
      - run: raps bucket list

workflows:
  main:
    jobs:
      - translate
```

## Kubernetes

### Job –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏—Ö –∑–∞–≤–¥–∞–Ω—å

```yaml
# raps-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: raps-translate
spec:
  template:
    spec:
      containers:
        - name: raps
          image: ghcr.io/dmytro-yemelianov/raps:3.8.0
          command: ["raps", "translate", "start", "$(URN)", "--wait"]
          env:
            - name: APS_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: aps-credentials
                  key: client-id
            - name: APS_CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  name: aps-credentials
                  key: client-secret
            - name: URN
              value: "dXJuOmFkc2sub2JqZWN0czp..."
      restartPolicy: Never
```

### CronJob –¥–ª—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å

```yaml
# raps-cronjob.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: raps-cleanup
spec:
  schedule: "0 2 * * 0"  # –©–æ–Ω–µ–¥—ñ–ª—ñ –æ 2:00
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: raps
              image: ghcr.io/dmytro-yemelianov/raps:3.8.0
              command: ["/bin/sh", "-c"]
              args:
                - |
                  raps bucket list --output json | \
                  jq -r '.[] | select(.policyKey == "transient") | .bucketKey' | \
                  while read bucket; do
                    raps bucket delete "$bucket" --yes || true
                  done
              envFrom:
                - secretRef:
                    name: aps-credentials
          restartPolicy: OnFailure
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Kubernetes Secret

```bash
kubectl create secret generic aps-credentials \
  --from-literal=client-id="$APS_CLIENT_ID" \
  --from-literal=client-secret="$APS_CLIENT_SECRET"
```

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö –æ–±—Ä–∞–∑—ñ–≤

–†–æ–∑—à–∏—Ä—Ç–µ –æ–±—Ä–∞–∑ RAPS –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:

```dockerfile
# Dockerfile
FROM ghcr.io/dmytro-yemelianov/raps:3.8.0

# –î–æ–¥–∞—Ç–∏ jq –¥–ª—è –æ–±—Ä–æ–±–∫–∏ JSON
RUN apk add --no-cache jq

# –î–æ–¥–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏
COPY scripts/ /scripts/
RUN chmod +x /scripts/*.sh

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
CMD ["raps", "--help"]
```

–ó–±—ñ—Ä–∫–∞ —Ç–∞ –∑–∞–ø—É—Å–∫:

```bash
docker build -t my-raps .
docker run --rm my-raps bucket list
```

## –£—Å—É–Ω–µ–Ω–Ω—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –í—ñ–¥–º–æ–≤–∞ –≤ –¥–æ—Å—Ç—É–ø—ñ –¥–æ —Ç–æ–º—ñ–≤

```bash
# –†—ñ—à–µ–Ω–Ω—è: –∑–∞–ø—É—Å–∫ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
docker run --rm \
  -u $(id -u):$(id -g) \
  -v $(pwd)/models:/data \
  ghcr.io/dmytro-yemelianov/raps:latest \
  object upload my-bucket /data/model.rvt
```

### –ü—Ä–æ–±–ª–µ–º–∏ –∑ –º–µ—Ä–µ–∂–µ—é

```bash
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –º–µ—Ä–µ–∂—É —Ö–æ—Å—Ç–∞ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
docker run --rm --network host \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  auth test
```

### –†–µ–∂–∏–º –∑–Ω–µ–≤–∞–¥–∂–µ–Ω–Ω—è

```bash
docker run --rm \
  -e APS_CLIENT_ID="$APS_CLIENT_ID" \
  -e APS_CLIENT_SECRET="$APS_CLIENT_SECRET" \
  ghcr.io/dmytro-yemelianov/raps:latest \
  --debug auth test
```

## –ü–æ–≤'—è–∑–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [–†–µ–∂–∏–º CLI](/docs/mode-cli) ‚Äî –î–æ–≤—ñ–¥–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞
- [GitHub Actions](/docs/mode-github-actions) ‚Äî GitHub CI/CD
- [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è](/docs/configuration) ‚Äî –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
- [–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π raps-docker](https://github.com/dmytro-yemelianov/raps-docker) ‚Äî –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ Docker-–æ–±—Ä–∞–∑—É
